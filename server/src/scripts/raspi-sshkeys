#!/bin/bash

# Check SSH keys and agent
while [ "$SSH_KEY" != "y" ] && [ "$SSH_KEY" != "Y" ] && [ "$SSH_KEY" != "n" ] && [ "$SSH_KEY" != "n" ]; do
    echo -n " â” Do you have a SSH key? (y/n): " && read SSH_KEY

    if [ "$SSH_KEY" == "n" ] || [ "$SSH_KEY" == "N" ]; then
        ssh-keygen
		eval `ssh-agent`
	elif [ "$SSH_KEY" == "y" ] || [ "$SSH_KEY" == "Y" ]; then
		echo -n ""
	else
		echo -ne "\e[1A\e[K"
    fi
done

# Install arp-scan
echo " â³ Network tools install"
sudo apt-get install arp-scan 1> /dev/null
echo -ne "\e[1A\e[K"
echo " âœ… Network tools install"

# Raspberry Pi: IP address
echo " ğŸ” Raspberry Pi search"
RASPBERRY_IP=$(sudo arp-scan -l | grep "Raspberry Pi Foundation" | awk '{print $1;}')

if [ -z "$RASPBERRY_IP" ]; then
	echo -ne "\e[1A\e[K"
	echo " â Raspberry Pi search"
	exit 1
else
	echo -ne "\e[1A\e[K"
	echo " âœ… Raspberry Pi search"
	export RASPBERRY_IP

	# Raspberry Pi: default user and password
	RASPBERRY_USER=pi
	RASPBERRY_PASSWORD=raspberry

	# echo "$RASPBERRY_USER@$RASPBERRY_IP's password: $RASPBERRY_PASSWORD"
	echo "    â„¹ï¸  User     : $RASPBERRY_USER"
	echo "    â„¹ï¸  Password : $RASPBERRY_PASSWORD"
	echo "    â„¹ï¸  IP       : $RASPBERRY_IP"

	# Set up acces using ssh key
	echo " ğŸ“¤ Send SSH key to Raspberry"
	ssh-copy-id $RASPBERRY_USER@$RASPBERRY_IP 1> /dev/null

	if [ $? -ne 0 ]; then
		echo -ne "\e[1A\e[K"
		echo " â SSH key key to Raspberry"
		exit 1
	else
		echo -ne "\e[1A\e[K"
		echo " âœ… Send SSH key to Raspberry"
	fi
fi
